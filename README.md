## 2021 Project 2

![](logo.png)

Ερωτήσεις:

1. Πού βρίσκεται ο Γιώργος;
1. Ποιος έκλεψε τα αρχεία του "Plan X";
1. Πού βρίσκονται τα αρχεία του "Plan X";
1. Ποια είναι τα results του "Plan Y";
1. Ποιο είναι το code του "Plan Z";




#### Παρατηρήσεις

- Οι ίδιες ομάδες με την εργασία 1
- Εγγραφή στο github: https://classroom.github.com/g/jlkOQHdH 
- Μόλις ολοκληρώσετε κάθε βήμα στέλνετε claim στο ys13@chatzi.org
- Για τα βήματα 3-5 απαιτείται να γράψετε ένα πρόγραμμα που να αυτοματοποιεί την εύρεση της λύσης.
  Μπορείτε να χρησιμοποιήσετε ό,τι γλώσσα προγραμματισμού θέλετε, αλλά θα πρέπει να μπορώ να το τρέξω
  σε Ubuntu 20.04 χρησιμοποιώντας software που είναι διαθέσιμο στο Ubuntu. Θα πρέπει επίσης
  να φτιάξετε ένα script `run.sh` που εκτελεί το πρόγραμμα με ό,τι παραμέτρους χρειάζονται.
- Επίσης γράφετε report στο README.md με τα βήματα που ακολουθήσατε, και το κάνετε commit μαζί με οποιοδήποτε κώδικα χρησιμοποιήσατε
- Βαθμολογία
    - Η δυσκολία στα βήματα αυξάνεται απότομα.
    - Για ό,τι δεν ολοκληρώσετε περιγράψτε (και υλοποιήστε στο πρόγραμμα) την πρόοδό σας και πώς θα μπορούσατε να συνεχίσετε.
    - Με τα πρώτα 2 βήματα παίρνετε 5 στο μάθημα (αν έχετε πάει καλά στην εργασία 1)
    - Με τα 3-5 φτάνετε μέχρι το 10 (δεν υπάρχει γραπτή εξέταση)
    - Για τους μεταπτυχιακούς τα 3-5 είναι προαιρετικά. ΔΕΝ αντικαθιστούν το project
     (αλλά μπορούν να λειτουργήσουν προσθετικά στο βαθμό της εργασίας 1)
    - Για τα βήματα 3-5 μπορεί να γίνει προφορική εξέταση
- Timeline
    - Την πρώτη εβδομάδα δεν υπάρχουν hints
    - 11/6: αρχίζουν τα hints για τα βήματα 1,2
    - 16/6: deadline για τα βήματα 1,2
    - Για τα βήματα 3-5 δίνονται hints μόνο σε όσους ζητήσουν (με μικρό penalty)
    - 11/7: deadline για τα βήματα 3-5
- Η ταχύτητα των λύσεων (και ο αριθμός hints που έχουν δοθεί) μετράει στο βαθμό
(ειδικά για τα βήματα 1,2)

- __Οχι spoilers__
- __Οχι DoS__ (ή μαζικά requests, δε χρειάζεται
κάτι τέτοιο)


# CTF Report

## Step 1

### First things first
While visiting and browsing the code of the instructor-given .onion link, we skimmed the blog-article about onion site security, hence we discovered that the site-creator allowed us to view the `/server-info` page. There we discovered the existence of a second site. At the same time we noticed that the cookie in the site, when changed, printed some interesting messages in the user id section. We also discovered that the cookie was generated by the following algorithm:
```
Let 'L' be the message you want to display in user id field. 
1) Y = "SHA256(L)"
2) X = "L:Y"
3) COOKIE = BASE64(X)
```
so we constructed a small python script to generate cookies that would print our desired input.

### The bypass

Visiting the second site we bumped into a user validation page. Since we failed to login with simple credentials, we checked the respective `/server-info` page and also we tried to access the `/robots.txt` page, where we found something quite interesting: `.phps` files where allowed, but why? So we checked if there was a `access.phps` page. So now we just had to find the `$desired` variable, being *1337* and now we had to find the password. After a little googling we found out that the `strcmp()` function was quite vulnerable even if the condition check was *strict*. We could pass an array as `$password` and bypass the login section. We tried something like this: `?user=0001337&password[]=0`.

### Blogging

After loggin in, we browsed the blog a little and found out a quite-obscurely hidden post-page named `/post3.html` under `/blogposts7589109238/` that actualy gave us the user-id we had to use at *YS13 fixers* site. Using our script and changing the cookie via the `document.cookie` attribute in the JS console, we found about George Komninos' secret back-up, that contained the encrypted files of firefox and signal logs, so we knew that should do it, but we did not find the decryption key... yet.

### Ethereum Transactions

Reading the note George left, we got interested in the meaning of the last line `ropsten <hex number>`. We tried to transform it to ascii, in case we got anything secret-like and that failed. Then we googled about `ropsten`. Firstly, we found it was a transaction wallet, but (little did we knew) we thought this was a long shot. The next thing we came accross was a Sweden bus station in Stockholm... well we revisited the first idea. We found out that we could embed the hex into a transaction-record link and there we actually found that the hex line in the note resembled an *Ethereum Transaction Hash*, that has taken place 13 days earlier (what a coincidence!?) and has the ammount of 0.01 Ethereum ($0.00 USD). This record had an inputData line `bigtent` in hex encoding. We kept that in mind and continued...

### Decrypting Logs 

Having `bigtent` as our latest discovery, we assumed that it is the `<secret string>` part of the key's SHA256 input. Thus, we only needed to find the `<current date in RFC3339 format>` field. Having ran out of clues, we tried to brute-force the date (after all, it was very unlikely that George would showcase a future date for his example `SHA256("2020-05-18 cement")`, so we thought that the *actual* date was somewhere in 2020 or 2021 - a total of around 700 dates to try). We used `/step1/decrypt_gpg.sh` and our favorite scripting language (bash for life) for the cracking.

After successfully decrypting the logs, we read the `signal.log` and assumed that we should look for a specific commit, for which we knew its hash. But, in which repo?

The answer was revealed to us after dumping around 500MB of "[en.wikipedia.org/wiki/The_Conversation](https://en.wikipedia.org/wiki/The_Conversation)" lines in the `firefox.log`, with the divine command `$ cat firefox.log | grep -v 'The_Conversation[^H]'`. It was none other than the tor-project fork by the infamous dev *asd-d6*: https://github.com/asn-d6/tor .

### Git commits and RSA hackz

The [commit](https://github.com/asn-d6/tor/commit/4ec3bbea5172e13552d47ff95e02230e6dc99692) we were instructed to look for contained the following cryptic message:
```
/**
 * Hey Maria... So I went to the Rivest club again yesterday and met a guy who
 * sold me tickets that will take me out of this crazy city. I hope that in a
 * few days we will be together again. Find me at:
 *
 *     http://aqwlvm4ms72zriryeunpo3uk7myqjvatba4ikl3wy6etdrrblbezlfqd.onion/x||y||x||y.txt
 *
 *          where || means concatenation
 *
 ******
 *
 * N = 127670779
 * e = 7
 *
 * E(x) = 122880244
 * E(y) = 27613890
 */

```

Just by observing **N** and **e** the RSA crypto algorithm came to mind.
Having a famous [quote](https://en.wikiquote.org/wiki/Ken_Thompson) as our guide, we tried a very advanced and underground technique to crack RSA, brute-force. We noticed that N is a pretty small integer (< 32bits) thus we used the `find_rsa_pq.py` script to learn the `p` and `q` used in the generation of the keys. Knowing `p` and `q`, we used https://www.wolframalpha.com/ for a couple of modulo operations and eventually got `x = 306` and `y = 3735`.

The `/30637353063735.txt` file we found stated:

```
Hey M,

I just started my ascent to the Gilman's Point on the Kilimanjaro.

I will set my camp there and wait for you. Please bring some clean water because
the people in the village were trying to poison me so I didn't get any.

see you~~
```

Thus disclosing George's location (**Gilman's Point on the Kilimanjaro**).

PS. We noticed the eerie resemblance between George and the famous Kurt Gödel, in the fear of getting poisoned - hopefully George won't end up like his counterpart (guess we'll find out next year).

## Step 2

Getting access to the blog file, allowed us to get the link for an onion server that required username and password (we did not yet acquired). According to the relative post the server src code was in a github repo, chatziko/pico, so we cloned it and installed it in our machines. The moment we compiled the code we noticed a warning (unsual for chatziko coding standards) with a `-Wformat-security` flag, so we investigate it a little further. The first thing we bumped into was [Format String Software Attack](https://owasp.org/www-community/attacks/Format_string_attack) by OWASP so we knew we did good. A couple minutes later we tried the described attack and we passed the following username `%x %x %x %x %x %x %s` and got the username `admin` and the password md5 hash `e5614e27f3c21283ad532a1d23b9e29d` that we cracked by putting it in famous online md5 crackers and got  the password `bob's your uncle`.

After a successful log-in, we were greeted by a not-so-friendly message:
```
Hacked by 5l0ppy 8uff00n5 
```
Thus we figured that **5l0ppy 8uff00n5** had stolen the "Plan X" server files.

## Step 3

## Step 4

## Step 5
